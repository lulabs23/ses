<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8" />
<title>Sociomoov – Révision SES</title>
<style>
:root{
  --primary:#58cc02;--bg:#f7f8fa;--text:#1f2937;--card:#fff;
  --socio:#3b82f6;--eco:#ef4444;--cross:#8b5cf6;
}
body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto;background:var(--bg);color:var(--text)}
#app{max-width:900px;margin:40px auto;padding:24px}
h1{text-align:center;font-weight:800}
.lead{text-align:center;color:#555}
.card{background:var(--card);border-radius:20px;padding:24px;box-shadow:0 6px 20px rgba(0,0,0,.06)}
.grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(260px,1fr));gap:22px}
.chapter-card{text-align:center}
.chapter-card.socio{border:3px solid var(--socio)}
.chapter-card.eco{border:3px solid var(--eco)}
.chapter-card.cross{border:3px solid var(--cross)}
button{padding:12px 18px;border-radius:999px;border:none;cursor:pointer;font-weight:600}
.btn-primary{background:var(--primary);color:#fff}
.btn-secondary{background:#fff;border:1px solid #ddd}
.progress-circle{width:110px;height:110px;margin:0 auto 14px}
input{width:100%;padding:10px;border-radius:12px;border:1px solid #ddd;margin-top:8px}
.recap-item{padding:12px;border-radius:12px;margin-bottom:10px;background:#f1f5f9}
.recap-item.ok{border-left:6px solid #16a34a}
.recap-item.ko{border-left:6px solid #dc2626}
</style>
</head>
<body>
<div id="app">
  <div class="card" style="display:flex;justify-content:space-between;align-items:center">
    <div>
      <h2 style="margin:0">Session</h2>
      <div id="lastQuiz" style="font-size:.9rem;color:#555">Aucune session</div>
    </div>
    <div id="scoreHeader" style="font-size:1.3rem;font-weight:800">0 / 0</div>
  </div>

  <h1>Réviser en s'entraînant</h1>
  <p class="lead">Choisis un chapitre pour commencer</p>
 
  <div id="chapters" class="grid"></div>
  <div id="content" style="margin-top:24px"></div>
</div>

<script>
/*********************
 * DONNÉES
 *********************/
let currentChapter=null, questionIndex=0, defIndex=0;
let mode='questions';
let allQuestions=[], defQuestions=[], answersLog=[];
let session={success:0,total:0,last:null};
const records=JSON.parse(localStorage.getItem('records')||'{}');

const chapters={
  engagement:{
    number:"Chapitre 1",
    type:"socio",
    title:"Comment expliquer l'engagement politique dans les sociétés démocratiques ?",
    details:"Objectifs d’apprentissage à compléter.",
    questions:[
      {q:"Présente les quatre formes de l'engagement politique.",expected:[["vote"],["engagement","associatif"],["militant","militantisme"],["consommation","engagée"]]},
      {q:"Explique le paradoxe de l'action collective.",expected:[["passagers","clandestins"],["absence","mobilisation"]]},
      {q:"Présente les trois raisons de l'engagement politique des individus.",expected:[["incitations","sélectives"],["rétributions","symboliques"],["structure","opportunités","politiques"]]},
      {q:"Présente les cinq variables sociodémographiques qui influencent l'engagement politique.",expected:[["csp"],["diplôme"],["âge"],["génération"],["sexe"]]},
      {q:"Explique l'évolution de l'action collective (avant 1970).",expected:[["centrée","travail"],["syndicats","ouvriers"],["partis","politiques"],["grèves","manifestations"],["vote"]]},
      {q:"Explique la diversité de l'action collective.",expected:[["objets"],["acteurs"],["répertoires"]]},
      {q:"Présente les trois objets de l'action collective.",expected:[["conflits","travail"],["luttes","minoritaires"],["nouveaux","enjeux"]]},
      {q:"Présente les quatre acteurs de l'action collective.",expected:[["partis","politiques"],["syndicats"],["associations"],["groupements","personnes"]]},
      {q:"Présente la diversité des répertoires de l'action collective.",expected:[["manifestations"],["grèves"],["actions","choc"],["pétitions"],["vote"],["non-respect","loi"]]}
    ],
    defs:{
      "Engagement politique":"Ensemble des actions visant à influencer les décisions politiques.",
      "Action collective":"Action menée par plusieurs individus pour défendre un intérêt commun.",
      "Passagers clandestins":"Individus qui bénéficient d’une action collective sans y participer."
    }
  },

  croissance:{
    number:"Chapitre 2",
    type:"eco",
    title:"Quels sont les sources et les défis de la croissance économique ?",
    details:"Comprendre les sources et les limites de la croissance.",
    questions:[
      {q:"Présente le processus historique de la croissance économique.",expected:[["avant","xviii"],["révolution","industrielle"],["1945","1970"],["stagnation","crises"]]},
      {q:"Comment se définit la croissance économique ?",expected:[["augmentation","durable"],["production"],["biens","services"]]},
      {q:"Par quel indicateur mesure-t-on la croissance économique ?",expected:[["pib"],["valeurs","ajoutées"]]},
      {q:"Qu’est-ce que le taux de croissance économique ?",expected:[["variation"],["pourcentage"],["pib"]]},
      {q:"Quels sont les deux facteurs de production ?",expected:[["travail"],["capital"]]},
      {q:"Quelles sont les deux sources de la croissance économique ?",expected:[["accumulation","facteurs"],["productivité","globale","facteurs"]]},
      {q:"À quoi correspond la croissance extensive ?",expected:[["augmentation"],["quantité","facteurs"]]},
      {q:"À quoi correspond la croissance intensive ?",expected:[["efficacité"],["facteurs","production"]]},
      {q:"Comment le progrès technique crée-t-il des gains de productivité ?",expected:[["innovation"],["amélioration","production"],["pgf"]]},
      {q:"Pourquoi le progrès technique est-il dit endogène ?",expected:[["investissements"],["entreprises"],["etat"]]},
      {q:"En quoi les investissements rendent-ils la croissance auto-entretenue ?",expected:[["rendements","croissants"],["innovation"],["richesse"]]},
      {q:"Quel est le rôle des institutions dans la croissance économique ?",expected:[["règles"],["confiance"],["échanges"]]},
      {q:"Pourquoi les droits de propriété incitent-ils à investir et innover ?",expected:[["sécurité"],["brevets"],["investissements"]]},
      {q:"Présente le processus de destruction créatrice.",expected:[["création"],["nouveaux","produits"],["destruction"],["obsolète"]]},
      {q:"Quel est l’impact du progrès technique sur les inégalités de revenus ?",expected:[["qualifiés"],["salaires","élevés"],["inégalités"]]},
      {q:"Quelles sont les trois principales limites écologiques de la croissance soutenable ?",expected:[["épuisement","ressources"],["pollution"],["réchauffement","climatique"]]},
      {q:"Comment l’innovation peut-elle permettre une croissance soutenable ?",expected:[["énergies","renouvelables"],["réduction","pollution"],["progrès","technique"]]}
    ],
    defs:{
      "Croissance économique":"Augmentation durable de la production de biens et de services.",
      "PIB":"Somme des valeurs ajoutées produites dans un pays.",
      "Taux de croissance économique":"Variation en pourcentage du PIB.",
      "Facteurs de production":"Travail et capital utilisés pour produire.",
      "Croissance extensive":"Croissance par augmentation de la quantité de facteurs.",
      "Croissance intensive":"Croissance par amélioration de l’efficacité des facteurs.",
      "Productivité globale des facteurs":"Efficacité combinée du travail et du capital.",
      "Progrès technique":"Amélioration des techniques de production.",
      "Gains de productivité":"Production supplémentaire sans augmenter les facteurs.",
      "Innovation":"Application d’une invention à la production.",
      "Endogène":"Lié au fonctionnement interne de l’économie.",
      "Institution":"Règles formelles et informelles encadrant les échanges.",
      "Droits de propriété":"Droits d’utiliser, modifier, vendre un bien.",
      "Croissance soutenable":"Croissance respectant les générations futures.",
      "Limites écologiques":"Contraintes environnementales à la croissance."
    }
  },

  structure:{
    number:"Chapitre 3",
    type:"socio",
    title:"Comment est structurée la société française actuelle ?",
    details:"Analyser la structuration et la hiérarchisation de l’espace social.",
    questions:[
      {q:"Distingue la structuration et la hiérarchisation de l’espace social.",expected:[["structuration"],["hiérarchisation"],["classement"],["inégalités"]]},
      {q:"Présente les sept facteurs qui permettent d’analyser l’espace social.",expected:[["revenu"],["diplôme"],["profession"],["âge"],["sexe"],["ménage"],["lieu","résidence"]]},
      {q:"Explique les quatre évolutions de la structure socioprofessionnelle française.",expected:[["salarisation"],["tertiairisation"],["qualification"],["féminisation"]]},
      {q:"Présente la théorie des classes sociales selon Karl Marx.",expected:[["classe","en","soi"],["classe","pour","soi"],["lutte","classes"]]},
      {q:"Présente la théorie de la stratification sociale de Max Weber.",expected:[["économique"],["social"],["politique"]]},
      {q:"Explique les différences entre les visions de Marx et Weber.",expected:[["monodimensionnelle"],["multidimensionnelle"]]},
      {q:"Quels arguments remettent en cause la pertinence des classes sociales ?",expected:[["moyennisation"],["individualisation"],["intra-classes"]]},
      {q:"Explique en quoi les classes sociales n’ont pas totalement disparu.",expected:[["inter-classes"],["élites"],["classes","populaires"]]},
      {q:"Explique la différence entre distance inter-classes et intra-classes.",expected:[["entre"],["au","sein"]]}
    ],
    defs:{
      "Espace social":"Représentation de la société à partir des positions sociales.",
      "Structuration":"Regroupement des individus selon des critères communs.",
      "Hiérarchisation":"Classement des groupes sociaux selon des inégalités.",
      "Catégorie socioprofessionnelle":"Classement statistique des professions.",
      "Structure socioprofessionnelle":"Répartition des actifs selon les CSP.",
      "Salarisation":"Hausse de la part des salariés.",
      "Tertiarisation":"Hausse du secteur des services.",
      "Qualification":"Niveau de compétences ou de diplôme.",
      "Féminisation":"Augmentation de la part des femmes dans l’emploi.",
      "Classes sociales":"Groupes hiérarchisés partageant des caractéristiques communes.",
      "Stratification sociale":"Hiérarchie sociale multidimensionnelle.",
      "Distance inter-classes":"Écarts entre groupes sociaux.",
      "Distance intra-classes":"Écarts au sein d’un même groupe.",
      "Individualisation":"Affaiblissement des appartenances collectives.",
      "Identification subjective":"Sentiment d’appartenance à un groupe.",
      "Rapports sociaux de genre":"Inégalités construites entre hommes et femmes."
    }
  },

  commerce:{
    number:"Chapitre 4",
    type:"eco",
    title:"Quels sont les fondements du commerce international et de l’internationalisation de la production ?",
    questions:[
      {q:"Quels sont les deux grands types d’échanges internationaux ?",expected:[["pays","différents"],["pays","comparables"]]},
      {q:"Sur quel élément le commerce international repose t-il en partie ?",expected:[["spécialisation","internationale"]]},
      {q:"Selon Ricardo, dans quoi un pays doit-il se spécialiser ?",expected:[["avantage","comparatif"]]},
      {q:"Par quoi les avantages comparatifs s’expliquent-ils ?",expected:[["dotations","factorielles"],["dotations","technologiques"]]},
      {q:"Comment expliquer les échanges entre pays comparables ?",expected:[["différenciation","produits"],["différenciation","qualité","verticale"],["différenciation","caractéristiques","horizontale"],["fragmentation","chaine","valeur"]]},
      {q:"Explique pourquoi la compétitivité d’un pays dépend de celle de ses entreprises.",expected:[["productivité"],["entreprises"],["compétitivité"]]},
      {q:"Pourquoi seules certaines entreprises peuvent-elles exporter ?",expected:[["coûts"],["productives"],["grandes","entreprises"]]},
      {q:"Énumère les deux stratégies utilisées par les entreprises pour internationaliser la chaîne de valeur.",expected:[["sous-traitance"],["investissements","directs","étranger"]]},
      {q:"Énumère les trois effets du commerce international.",expected:[["gains","consommateurs"],["baisse","inégalités","entre","pays"],["hausse","inégalités","revenus","sein","pays"]]},
      {q:"Le ____ vise à supprimer les barrières commerciales tandis que le ____ vise à les renforcer.",expected:[["libre-échange"],["protectionnisme"]]},
      {q:"Présente deux avantages et une limite du libre-échange.",expected:[["prix","faibles"],["diversité"],["inégalités"]]},
      {q:"Présente un aspect positif et une limite du protectionnisme.",expected:[["protéger","emplois"],["hausse","prix"]]}
    ],
    defs:{
      "Commerce international":"Échanges de marchandises entre pays.",
      "Spécialisation internationale":"Concentration de la production d’un pays dans certains domaines destinés à l’exportation.",
      "Avantage comparatif":"Domaine dans lequel un pays est relativement le plus efficace ou le moins inefficace.",
      "Dotation factorielle":"Quantité et qualité des facteurs de production disponibles dans un pays.",
      "Dotation technologique":"Niveau de technologies, de capital humain et d’innovation d’un pays.",
      "Différenciation des produits":"Stratégie visant à distinguer un produit par la qualité ou les caractéristiques.",
      "Chaîne de valeur":"Ensemble des étapes nécessaires à la production d’un bien ou service.",
      "Fragmentation de la chaîne de valeur":"Répartition des étapes de production dans plusieurs pays.",
      "Productivité":"Efficacité avec laquelle les facteurs de production sont utilisés.",
      "Compétitivité":"Capacité à faire mieux que les concurrents sur les marchés internationaux.",
      "Firmes":"Très grandes entreprises présentes dans plusieurs pays.",
      "Internationalisation de la chaîne de valeur":"Dispersion mondiale des étapes de production.",
      "Libre-échange":"Politique favorisant la suppression des barrières commerciales.",
      "Protectionnisme":"Politique visant à limiter les importations pour protéger l’économie nationale."
    }
  },

  mobilite:{
  number:"Chapitre 5",
  type:"socio",
  title:"Quels sont les facteurs de la mobilité sociale ?",
  details:"Analyser et comprendre les déterminants de la mobilité sociale.",
  questions:[
    {q:"Quelles sont les différentes formes de mobilités ?", expected:[["géographique","lieu"],["professionnelle","métier"],["sociale","position","sociale"]]},
    {q:"Comment mesure-t-on la mobilité sociale ?", expected:[["tables","mobilité"],["insee"],["csp","père","individu"]]},
    {q:"Distingue la table des destinées de la table de recrutement.", expected:[["destinée","enfants","deviennent"],["recrutement","origine","parents"]]},
    {q:"Quel est l’intérêt principal des tables de mobilité ?", expected:[["mesurer","mobilité","observée"],["ensemble","pays"]]},
    {q:"Présente deux limites des tables de mobilité.", expected:[["population","partielle"],["csp","france"],["revenus","non","pris","en","compte"]]},
    {q:"Distingue mobilité ascendante, descendante et déclassement.", expected:[["ascendante","position","supérieure"],["descendante","inférieure"],["déclassement","diplôme","supérieur","emploi","inférieur"]]},
    {q:"Distingue mobilité verticale, horizontale et immobilité.", expected:[["verticale","hiérarchie"],["horizontale","csp","équivalente"],["immobilité","même","csp"]]},
    {q:"Qu’est-ce que la reproduction sociale ?", expected:[["même","position","parents"]]},
    {q:"Caractérise les mobilités masculine et féminine.", expected:[["femmes","mobilité","ascendante"],["plafond","verre"]]},
    {q:"Distingue mobilité sociale et fluidité sociale.", expected:[["mobilité","changement","csp"],["fluidité","égalité","chances"]]},
    {q:"Pourquoi la mobilité sociale observée dépend-elle de la mobilité structurelle ?", expected:[["évolution","structure","socioprofessionnelle"],["création","disparition","emplois"]]},
    {q:"Explique l’impact de l’évolution des structures socioprofessionnelles sur la mobilité sociale.", expected:[["tertiairisation"],["féminisation"],["qualification"]]},
    {q:"Explique le rôle des niveaux de formation sur la mobilité sociale.", expected:[["diplôme"],["mobilité","ascendante"],["déclassement"]]},
    {q:"Explique le rôle de la famille sur la mobilité sociale.", expected:[["ressources","familiales"],["configuration","familiale"],["capitaux"]]}
  ],
  defs:{
    "Mobilité sociale":"Changement de position sociale d’un individu au cours de sa vie ou par rapport à ses parents.",
    "Mobilité intergénérationnelle":"Mobilité entre la position sociale des parents et celle des enfants.",
    "Mobilité intragénérationnelle":"Mobilité au cours de la vie d’un individu.",
    "Mobilité géographique":"Changement de lieu de vie.",
    "Mobilité professionnelle":"Changement de profession.",
    "Tables de mobilité":"Tableaux statistiques mesurant les changements de CSP entre générations.",
    "Table de destinée":"Table indiquant ce que deviennent les enfants d’une CSP donnée.",
    "Table de recrutement":"Table indiquant l’origine sociale des individus d’une CSP.",
    "Mobilité observée":"Part des individus ayant changé de CSP par rapport à leurs parents.",
    "Mobilité ascendante":"Accès à une position sociale plus élevée.",
    "Mobilité descendante":"Accès à une position sociale inférieure.",
    "Déclassement":"Situation où le niveau de diplôme est supérieur à la position occupée.",
    "Mobilité horizontale":"Changement de CSP sans modification de la hiérarchie sociale.",
    "Mobilité verticale":"Changement de position dans la hiérarchie sociale.",
    "Reproduction sociale":"Maintien de la même position sociale que les parents.",
    "Mobilité structurelle":"Mobilité liée aux transformations de la structure socioprofessionnelle.",
    "Configuration familiale":"Structure de la famille (taille, type, organisation).",
    "Ressources familiales":"Capitaux économiques, culturels et sociaux d’une famille.",
    "Niveaux de formation":"Diplômes et qualifications obtenus par un individu."
  }
},
  chomage:{number:"Chapitre 6",type:"eco",title:"Comment lutter contre le chômage ?",questions:[],defs:{},details:"À compléter."},
  travail:{number:"Chapitre 7",type:"socio",title:"Quelles mutations du travail et de l’emploi ?",questions:[],defs:{},details:"À compléter."},
  europe:{number:"Chapitre 8",type:"eco",title:"Quelles politiques économiques dans le cadre européen ?",questions:[],defs:{},details:"À compléter."},
  environnement:{number:"Chapitre 9",type:"cross",title:"Quelle action publique pour l’environnement ?",questions:[],defs:{},details:"À compléter."}
};

Object.keys(chapters).forEach(k=>{if(!records[k])records[k]={best:0};});
localStorage.setItem('records',JSON.stringify(records));

/*********************
 * AFFICHAGE ACCUEIL
 *********************/
const chaptersDiv=document.getElementById('chapters');
window.addEventListener('DOMContentLoaded',renderChapters);

function renderChapters(){
  chaptersDiv.innerHTML='';
  Object.keys(chapters).forEach(id=>{
    const c=chapters[id];
    const total=c.questions.length + Object.keys(c.defs).length;
    const best=records[id].best;
    const percent=total?Math.round((best/total)*100):0;
    const card=document.createElement('div');
    card.className=`card chapter-card ${c.type}`;
    card.innerHTML=`
      <svg class="progress-circle" viewBox="0 0 36 36">
        <path d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831" fill="none" stroke="#e5e7eb" stroke-width="4"/>
        <path d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831" fill="none" stroke="#58cc02" stroke-width="4" stroke-dasharray="${percent},100"/>
        <text x="18" y="20.5" text-anchor="middle" font-size="8">${best}/${total}</text>
      </svg>
      <h3>${c.number}</h3>
      <p>${c.title}</p>
      <div style="display:flex;gap:8px;justify-content:center;flex-wrap:wrap">
        <button class="btn-primary" onclick="startQuestions('${id}')">Questions</button>
        <button class="btn-secondary" onclick="startDefs('${id}')">Définitions</button>
        <button class="btn-secondary" onclick="showDetails('${id}')">Détails</button>
      </div>`;
    chaptersDiv.appendChild(card);
  });
}

/*********************
 * QUESTIONS
 *********************/
function startQuestions(id){
  mode='questions';currentChapter=id;questionIndex=0;
  allQuestions=[...chapters[id].questions];answersLog=[];
  session={success:0,total:0,last:null};
  chaptersDiv.style.display='none';
  showQuestion();
}

function showQuestion(){
  const c=document.getElementById('content');c.innerHTML='';
  if(questionIndex>=allQuestions.length){endSession();return;}
  const q=allQuestions[questionIndex];
  const card=document.createElement('div');card.className='card';
  card.innerHTML=`<h3>${q.q}</h3>`;
  q.expected.forEach(()=>card.innerHTML+=`<input placeholder="Réponse" />`);
  card.innerHTML+=`<div style="display:flex;gap:12px;margin-top:16px">
    <button class="btn-primary" onclick="validateQuestion()">Valider</button>
    <button class="btn-secondary" onclick="skipQuestion()">Passer</button>
  </div>`;
  c.appendChild(card);
}

function validateQuestion(){
  const q=allQuestions[questionIndex];
  const inputs=[...document.querySelectorAll('#content input')].map(i=>i.value.toLowerCase());
  let used=Array(q.expected.length).fill(false);let ok=true;
  inputs.forEach(v=>{
    let found=false;
    q.expected.forEach((keys,i)=>{
      if(!used[i] && keys.some(k=>v.includes(k))){used[i]=true;found=true;}
    });
    if(!found)ok=false;
  });
  if(used.some(u=>!u))ok=false;
  session.total++; if(ok)session.success++;
  answersLog.push({question:q.q,correct:ok,expected:q.expected});
  session.last=Date.now(); updateHeader();
  questionIndex++; showQuestion();
}

function skipQuestion(){
  const q=allQuestions[questionIndex];
  session.total++;
  answersLog.push({question:q.q,correct:false,expected:q.expected});
  updateHeader(); questionIndex++; showQuestion();
}

/*********************
 * DÉFINITIONS (appariement)
 *********************/
function startDefs(id){
  mode='defs'; currentChapter=id; defIndex=0;
  answersLog=[]; session={success:0,total:0,last:null};
  defQuestions=Object.entries(chapters[id].defs).map(e=>({term:e[0],def:e[1]}));
  chaptersDiv.style.display='none';
  showDef();
}

function showDef(){
  const c=document.getElementById('content');c.innerHTML='';
  if(defIndex>=defQuestions.length){endSession();return;}
  const q=defQuestions[defIndex];
  const terms=Object.keys(chapters[currentChapter].defs);
  const card=document.createElement('div');card.className='card';
  card.innerHTML=`<h3>À quel terme correspond cette définition ?</h3><p><em>${q.def}</em></p>`;
  terms.forEach(t=>{
    card.innerHTML+=`<button class="btn-secondary" style="display:block;width:100%;margin-top:8px" onclick="validateDef('${t.replace(/'/g,"\\'")}')">${t}</button>`;
  });
  c.appendChild(card);
}

function validateDef(term){
  const q=defQuestions[defIndex];
  const ok = term===q.term;
  session.total++; if(ok)session.success++;
  answersLog.push({question:q.term,correct:ok,expected:[[q.term+" : "+q.def]]});
  session.last=Date.now(); updateHeader();
  defIndex++; showDef();
}

/*********************
 * FIN DE SESSION
 *********************/
function endSession(){
  const total=session.total;
  if(session.success>records[currentChapter].best){
    records[currentChapter].best=session.success;
    localStorage.setItem('records',JSON.stringify(records));
  }
  renderChapters();
  const percent=total?Math.round((session.success/total)*100):0;
  const c=document.getElementById('content');
  c.innerHTML=`<div class="card" style="text-align:center">
    <svg class="progress-circle" viewBox="0 0 36 36">
      <path d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831" fill="none" stroke="#e5e7eb" stroke-width="4"/>
      <path d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831" fill="none" stroke="#58cc02" stroke-width="4" stroke-dasharray="${percent},100"/>
      <text x="18" y="20.5" text-anchor="middle" font-size="8">${session.success}/${total}</text>
    </svg>
    <h2>Récapitulatif de la session</h2>
  </div>`;
  answersLog.forEach(a=>{
    const div=document.createElement('div');
    div.className='recap-item '+(a.correct?'ok':'ko');
    let html=`${a.correct?'☑️':'❌'} ${a.question}`;
    if(!a.correct){html+=`<div style="font-size:.9rem;color:#555;margin-top:6px"><strong>Correction :</strong> ${a.expected.map(e=>e.join(' / ')).join(' ; ')}</div>`;}
    div.innerHTML=html; c.appendChild(div);
  });
  const btn=document.createElement('button');btn.className='btn-primary';btn.style.marginTop='20px';btn.textContent='Retour à l’accueil';btn.onclick=back;c.appendChild(btn);
}

function updateHeader(){
  document.getElementById('scoreHeader').textContent=`${session.success} / ${session.total}`;
  document.getElementById('lastQuiz').textContent=session.last?('Dernière session : '+new Date(session.last).toLocaleString()):'Session en cours';
}

function back(){document.getElementById('content').innerHTML='';chaptersDiv.style.display='grid';renderChapters();}

function showDetails(id){
  chaptersDiv.style.display='none';
  document.getElementById('content').innerHTML=`<div class="card"><h2>${chapters[id].number}</h2><p>${chapters[id].details||''}</p><button class="btn-primary" onclick="back()">Retour</button></div>`;
}

/*********************
 * TESTS
 *********************/
console.assert(chapters.engagement.questions.length>0,'Chapitre 1 vide');
console.assert(chapters.croissance.questions.length>0,'Chapitre 2 vide');
console.assert(chapters.structure.questions.length>0,'Chapitre 3 vide');
</script>
</body>
</html>
